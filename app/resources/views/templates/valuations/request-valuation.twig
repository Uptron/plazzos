{% extends 'main.twig' %}
{% block sidebar %}
    {% include 'partials/staff-siderbar.twig' %}
{% endblock %}
 {% block contenthead %}

     <div class="kt-subheader   kt-grid__item" id="kt_subheader">
         <div class="kt-subheader__main">
             <h3 class="kt-subheader__title">
                 Valuations </h3>
             <span class="kt-subheader__separator kt-hidden"></span>
             <div class="kt-subheader__breadcrumbs">
                 <a href="#" class="kt-subheader__breadcrumbs-home"><i class="flaticon2-shelter"></i></a>
                 <span class="kt-subheader__breadcrumbs-separator"></span>
                 <a href="" class="kt-subheader__breadcrumbs-link">
                     Request Valuation </a>

             </div>
         </div>

     </div>
 {% endblock %}
{% block body %}
    <div class="row">
        <div class="col-lg-12">
            <!--begin::Portlet-->
            <div class="kt-portlet">
                <div class="kt-portlet__head">
                    <div class="kt-portlet__head-label">
                        <h3 class="kt-portlet__head-title">
                            Request Valuation
                        </h3>
                    </div>
                </div>
                <form action="{{ path_for('staff.save-request') }}"  method="post" class="kt-form" id="kt-form" enctype="multipart/form-data">
                    <div class=" kt-portlet__body">
                        <div class="kt-section">
                            <div class="row">
                                <div class="col-xl-4">
                            <div class="form-group">
                                <label>Client Name:</label>

                                <input type="text" id="client_name" name="client_name" class="form-control"/>

                            </div>
                                </div>
                                <div class="col-xl-4">
                            <div class="form-group">
                                <label>Client Phone Number:</label>

                                <input type="text" id="client_phone" name="client_phone" class="form-control"/>

                            </div>
                                </div>
                                <div class="col-xl-4">
                            <div class="form-group">
                                <label>Client Email Address:</label>

                                <input type="text" id="client_email" name="client_email" class="form-control"/>

                            </div>
                                </div>
                            </div>

                            <div class="row">

                                <div class="col-xl-4">
                            <div class="form-group">
                                <label>Vehicle Make:</label>

                                <input type="text" id="vehicle_make" name="vehicle_make" class="form-control"/>

                            </div>
                                </div>
                                <div class="col-xl-4">
                            <div class="form-group">
                                <label>Vehicle Model:</label>

                                <input type="text" id="vehicle_model" name="vehicle_model" class="form-control"/>

                            </div>
                                </div>
                                <div class="col-xl-4">
                            <div class="form-group">
                                <label>Vehicle Type:</label>

                                <input type="text" id="vehicle_type" name="vehicle_type" class="form-control"/>

                            </div>
                                </div>
                            </div>
                            <div class="form-group">
                                <label>Vehicle Registration No:</label>

                                <input type="text" id="vehicle_reg" name="vehicle_reg" class="form-control"/>

                            </div>
                            <div class="form-group">
                                <label>Valuer:</label>

                                <select  id="valuer" name="valuer" class="form-control">
                                    <option value="">Choose Valuer</option>
                                    {% for valuer in valuers %}

                                        <option value="{{ valuer.id }}"> {{ valuer.valuerName }} </option>
                                    {% endfor %}
                                </select>

                            </div>

                            <div class="form-group">
                                <label>Attach Logbook:</label>

                                <input type="file" id="file" name="file" class="form-control"/>

                            </div>

                            <div class="form-group">
                                <label>Additional Comments:</label>

                                <textarea id="comments" name="comments" class="form-control">
                                </textarea>

                            </div>

                        </div>

                    </div>
                    <div class="kt-portlet__foot">
                        <div class="kt-form__actions">
                            <div class="row">
                                <div class="col-lg-5"></div>
                                <div class="col-lg-7">
                                    <a href="{{ path_for('staff.manage-requests') }}" type="button" id="btn_cancel" class="btn btn-primary">Cancel</a>
                                    <button type="button" id="btn_save" class="btn btn-success">Make Request</button>
                                </div>
                            </div>
                        </div>
                    </div>

                </form>


            </div>

            <!--end::Portlet-->
        </div>

    </div>

{% endblock %}
{% block javascripts %}
    <script type="text/javascript">
        $(document).ready(function() {

            $('#btn_save').click(function () {

                var client_name = $('#client_name').val();
                var client_phone=$('#client_phone').val();
                var client_email=$('#client_email').val();
                var vehicle_reg=$('#vehicle_reg').val();
                var vehicle_make=$('#vehicle_make').val();
                var vehicle_model=$('#vehicle_model').val();
                var vehicle_type=$('#vehicle_type').val();
                var valuer=$('#valuer').val();
                var comments=$('#comments').val();


                var data = new FormData();

//Form data
                var form_data = $('#kt-form').serializeArray();
                $.each(form_data, function (key, input) {
                    data.append(input.name, input.value);
                });

//File data
                var file_data = $('input[name="file"]')[0].files;
                for (var i = 0; i < file_data.length; i++) {
                    data.append("file", file_data[i]);
                }


                if (client_name == '') {
                    toastr.error("Error Occured!!!", 'You Must Provide The Client Name');
                    return;
                }

                if (client_phone == '') {
                    toastr.error("Error Occured!!!", 'You Must Provide The Client Name');
                    return;
                }
                if (vehicle_reg == '') {
                    toastr.error("Error Occured!!!", 'You have not provided the vehicle registration number');
                    return;
                }
                if (vehicle_make == '') {
                    toastr.error("Error Occured!!!", 'You must state the vehicle make');
                    return;
                }
                if (vehicle_model == '') {
                    toastr.error("Error Occured!!!", 'You must state the vehicle model');
                    return;
                }
                if (valuer == '') {
                    toastr.error("Error Occured!!!", 'You must specify a Valuer*');
                    return;
                }
               if (file_data == '') {
                    toastr.error("Error Occured!!!", 'Kindly attach the vehicle logbook');
                    return;
                }
                $.ajax({
                   // type: 'POST',
                    method: 'POST',
                    cache: false,
                    contentType: false,
                    processData: false,
                    url: '{{ path_for('staff.save-request') }}',
                    data:data,
                   /* data: {
                        client_name: client_name,
                        client_phone: client_phone,
                        client_email: client_email,
                        vehicle_reg:vehicle_reg,
                        vehicle_model:vehicle_model,
                        vehicle_make:vehicle_make,
                        vehicle_type:vehicle_type,
                        valuer:valuer,
                        logbook:logbook,
                        comments:comments

                    },*/
                    success: function(data)
                    {
                        toastr.success("Success", 'Your valuation request has been sent to the valuer');

                        window.setTimeout(function(){
                            window.location.href='/staff/manage-requests';
                        }, 3000);

                    },
                    error: function (jqXHR, textStatus, errorThrown)
                    {
                        alert(JSON.stringify(errorThrown));
                    }
                });

            });


        });
    </script>
{% endblock %}