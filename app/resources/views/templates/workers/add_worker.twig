{% extends 'main.twig' %}
 {% block contenthead %}

     <div class="kt-subheader   kt-grid__item" id="kt_subheader">
         <div class="kt-subheader__main">
             <h3 class="kt-subheader__title">
                 Workers </h3>
             <span class="kt-subheader__separator kt-hidden"></span>
             <div class="kt-subheader__breadcrumbs">
                 <a href="#" class="kt-subheader__breadcrumbs-home"><i class="flaticon2-shelter"></i></a>
                 <span class="kt-subheader__breadcrumbs-separator"></span>
                 <a href="" class="kt-subheader__breadcrumbs-link">
                     Add Worker </a>

             </div>
         </div>

     </div>
 {% endblock %}
{% block body %}
    <div class="row">
        <div class="col-lg-12">
            <!--begin::Portlet-->
            <div class="kt-portlet">
                <div class="kt-portlet__head">
                    <div class="kt-portlet__head-label">
                        <h3 class="kt-portlet__head-title">
                            Add Worker
                        </h3>
                    </div>
                </div>
                <div class="kt-portlet__body">
                <div class="form-group">
                    <label>Entry Method:</label>
                    <select id="method" class="form-control">
                        <option value="">Chose Method To Add Worker</option>
                        <option value="form">Single Entry Form</option>
                        <option value="excel">Bulk Upload</option>
                    </select>
                </div>
                </div>
                  <form class="kt-form" id="form" style="display:none;">
                      <div class="kt-portlet__body">
                          <div class="kt-section kt-section--first">
                        <div class="form-group">
                            <label>Worker Group:</label>

                                <select id="worker_group" name="worker_group" class="form-control">
                                    <option value="">Choose Worker Group</option>
                                    {% for group in groups %}

                                        <option value="{{ group.id }}"> {{ group.groupName }} </option>
                                    {% endfor %}
                                </select>

                        </div>

                        <div class="form-group">
                            <label>First Name:</label>

                                <input type="text" id="first_name" name="first_name" class="form-control"/>

                        </div>

                        <div class="form-group">
                            <label>Middle Name:</label>

                                <input type="text" id="middle_name" name="middle_name" class="form-control"/>

                        </div>

                        <div class="form-group">
                            <label>Last Name:</label>

                                <input type="text" id="last_name" name="last_name" class="form-control"/>

                        </div>

                     <div class="form-group">
                                  <label>Phone Number:</label>

                                  <input type="text" id="phone_number" name="phone_number" class="form-control"/>

                        </div>

                        <div class="form-group">
                            <label>ID Number:</label>

                                <input type="text" id="id_number" name="id_number" class="form-control"/>

                        </div>

                        <div class="form-group">
                            <label>Staff ID:</label>

                                <input type="text" id="staff_id" name="staff_id" class="form-control"/>

                        </div>

                       </div>
                      </div>
                          <div class="kt-portlet__foot">
                              <div class="kt-form__actions">
                                <a href="{{ path_for('merchant.manage-products') }}" type="button" id="btn_cancel" class="btn btn-primary">Cancel</a>
                                <button type="button" id="btn_save" class="btn btn-success">Add Worker</button>
                            </div>
                        </div>

                  </form>
                    </form>

                   <form method="post" action="{{ path_for('merchant.save-workers-bulk') }}" class="kt-form" id="excel" style="display:none;" enctype="multipart/form-data">
                    <div class="kt-portlet__body">
                        <div class="kt-section kt-section--first">
                            <div class="form-group">
                                <label>Worker Group:</label>
                                <select id="worker_group" name="worker_group" class="form-control">
                                    <option value="">Choose Worker Group</option>
                                    {% for group in groups %}

                                        <option value="{{ group.id }}"> {{ group.groupName }} </option>
                                    {% endfor %}
                                </select>
                            </div>

                            <div class="form-group">
                                <label>Choose File:</label>
                                <input type="file" name="excel" id="excel" class="form-control" />
                            </div>
                        </div>


                        <div class="kt-portlet__foot">
                            <div class="kt-form__actions">
                                <a href="{{ path_for('merchant.manage-workers') }}" type="button" id="btn_cancel" class="btn btn-primary">Cancel</a>
                                <button type="submit" id="bulk_save" class="btn btn-success">Upload Workers</button>
                            </div>
                        </div>
                    </div>
                </form>
                    </div>


            <!--end::Portlet-->
        </div>

    </div>
    <script type="text/javascript">

        $(document).ready(function () {

            $('#method').change(function() {
                var method= $('#method').val();

                if(method=="excel")
                {
                    $('#form').hide();
                    $('#excel').show();

                }
                else if(method=="form")
                {
                    $('#excel').hide();
                    $('#form').show();

                }
            });

            //Post Product

            $('#btn_save').click(function () {
                var worker_group = $('#worker_group').val();
                var first_name = $('#first_name').val();
                var last_name = $('#last_name').val();
                var middle_name = $('#middle_name').val();
                var id_number=$('#id_number').val();
                var staff_id=$('#staff_id').val();


                if (worker_group == '') {
                    toastr.error("Error Occured!!!", 'You must select a worker group');
                    return;
                }

                if (first_name == '') {
                    toastr.error("Error Occured!!!", 'Please Enter Your First Name');
                    return;
                }

                if (middle_name == '') {
                    toastr.error("Error Occured!!!", 'Please Enter Your Middle Name');
                    return;
                }
                if (last_name == '') {
                    toastr.error("Error Occured!!!", 'Please Enter Your Last Name');
                    return;
                }
                if (id_number == '') {
                    toastr.error("Error Occured!!!", 'You Must Enter Your ID Number');
                    return;
                }
                if (staff_id == '') {
                    toastr.error("Error Occured!!!", 'Set A Staff ID');
                    return;
                }

                $.ajax({
                    type: 'POST',
                    url: '{{ path_for('merchant.save-worker') }}',
                    data: {
                        worker_group: worker_group,
                        first_name: first_name,
                        last_name: last_name,
                        middle_name: middle_name,
                        id_number:id_number,
                        staff_id:staff_id
                    }
                })
                    .success(function (data) {
                        window.setTimeout(function(){
                            window.location.href='/worker/manage-workers';
                        }, 3000);
                    })
                    .fail(function (jqXHR, textStatus, errorThrown) {
                        alert(JSON.stringify(errorThrown));
                    });
            });
        });
    </script>
{% endblock %}
